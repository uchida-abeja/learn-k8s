# MinIO Deploymentへのパッチ: Pod起動時にイベント設定を自動実行
# Helm ChartのDeploymentにlifecycle postStartフックを追加
apiVersion: apps/v1
kind: Deployment
metadata:
  name: minio
spec:
  template:
    spec:
      containers:
      - name: minio
        lifecycle:
          postStart:
            exec:
              command:
              - /bin/sh
              - -c
              - |
                # MinIOの起動を待つ
                sleep 30
                
                # mc設定とイベント通知設定（環境変数から認証情報を取得）
                mc alias set myminio http://localhost:9000 ${MINIO_ROOT_USER} ${MINIO_ROOT_PASSWORD}
                mc event add myminio/raw-data arn:minio:sqs::PRIMARY:webhook --event put --suffix .mcap 2>/dev/null || true
                echo "Event notification configured"
