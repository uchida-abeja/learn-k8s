dags:
  persistence:
    enabled: false
  gitSync:
    enabled: false

scheduler:
  extraVolumes:
    - name: dags-volume
      configMap:
        name: airflow-dags
  extraVolumeMounts:
    - name: dags-volume
      mountPath: /opt/airflow/dags/pipeline.py
      subPath: pipeline.py

workers:
  extraVolumes:
    - name: dags-volume
      configMap:
        name: airflow-dags
  extraVolumeMounts:
    - name: dags-volume
      mountPath: /opt/airflow/dags/pipeline.py
      subPath: pipeline.py

webserver:
  extraVolumes:
    - name: dags-volume
      configMap:
        name: airflow-dags
  extraVolumeMounts:
    - name: dags-volume
      mountPath: /opt/airflow/dags/pipeline.py
      subPath: pipeline.py
  defaultUser:
    enabled: true
    username: admin
    # パスワードはSealed Secretで管理（実際の値は暗号化されています）
    # 本番環境では infrastructure/sealed-secrets/data-pipeline-airflow-sealed-secret.yaml を更新
    password: admin  # このvalueは使用されず、Secretから上書きされます

# Webserver Secret Key（セッション暗号化用）
# Sealed Secretで管理される webserver-secret-key を使用
webserverSecretKey: dummy-key-will-be-overwritten-by-secret

# Executor設定
executor: CeleryExecutor

# Redis設定 - Celery Executorに必要
redis:
  enabled: true

# ArgoCD経由のデプロイではHelm hooksを無効化
migrateDatabaseJob:
  enabled: true
  useHelmHooks: false

createUserJob:
  enabled: true
  useHelmHooks: false

data:
  metadataConnection:
    host: airflow-postgresql

# REST API認証設定 - Basic認証を有効化
config:
  api:
    auth_backends: airflow.api.auth.backend.basic_auth,airflow.api.auth.backend.session
  core:
    # 新規DAGをデフォルトでunpause状態にする
    dags_are_paused_at_creation: "False"

postgresql:
  image:
    repository: postgres
    tag: "13"
